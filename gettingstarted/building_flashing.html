<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Building and flashing examples &mdash; Tiliqua  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/platformpicker.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/platformpicker.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Simulating designs" href="simulation.html" />
    <link rel="prev" title="Getting Started" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Tiliqua
              <img src="../_static/logo.jpg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Keep Updated</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../devlog/index.html">Development Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community.html">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../foss_funding.html">Funding &amp; Open Source</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hardware</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../connections.html">Connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hardware_design.html">Electrical Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hardware_changes.html">Changelist</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Building &amp; Flashing</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Prerequisites</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Getting Started</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Building and flashing examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#building">Building</a></li>
<li class="toctree-l3"><a class="reference internal" href="#flashing">Flashing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#video-modes">Video Modes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="simulation.html">Simulating designs</a></li>
<li class="toctree-l2"><a class="reference internal" href="ila.html">Using the ILA</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../calibration.html">Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bootloader.html">Bootloader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Example Projects</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dsp/index.html">DSP Library</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://www.crowdsupply.com/apfaudio/tiliqua">Tiliqua on Crowd Supply</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/apfaudio/tiliqua">Tiliqua on GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://apf.audio/">Homepage (apf.audio)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Tiliqua</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Getting Started</a></li>
      <li class="breadcrumb-item active">Building and flashing examples</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/gettingstarted/building_flashing.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="building-and-flashing-examples">
<h1>Building and flashing examples<a class="headerlink" href="#building-and-flashing-examples" title="Link to this heading"></a></h1>
<section id="building">
<h2>Building<a class="headerlink" href="#building" title="Link to this heading"></a></h2>
<p>Each top-level bitstream has a command-line interface. You can see the options by running (for example):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># from `gateware` directory</span>
pdm<span class="w"> </span>dsp
</pre></div>
</div>
<p>The available options change depending on the top-level project. For example, many projects have video output, and from the CLI you can select the video modeline.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For prototype Tiliqua hardware, be careful to add an <code class="code highlight py python docutils literal highlight-python"><span class="o">--</span><span class="n">hw</span> <span class="n">r4</span></code> (or similar) flag specifying your hardware version to all commands below.</p>
</div>
<p>A few examples of building top-level bitstreams:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># from `gateware` directory</span>

<span class="c1"># for the selftest bitstream (prints diagnostics out DVI and serial)</span>
pdm<span class="w"> </span>selftest<span class="w"> </span>build
<span class="c1"># for a vectorscope / oscilloscope</span>
pdm<span class="w"> </span>xbeam<span class="w"> </span>build
<span class="c1"># for a polyphonic MIDI synth</span>
pdm<span class="w"> </span>polysyn<span class="w"> </span>build
<span class="c1"># for the LUNA-based 4in + 4out USB soundcard example</span>
<span class="c1"># note: LUNA USB port presents itself on the second USB port (not dbg)!</span>
pdm<span class="w"> </span>usb_audio<span class="w"> </span>build
<span class="c1"># for a 4-channel waveshaping oscillator</span>
pdm<span class="w"> </span>dsp<span class="w"> </span>build<span class="w"> </span>--dsp-core<span class="w"> </span>nco
<span class="c1"># for a diffusion delay effect</span>
pdm<span class="w"> </span>dsp<span class="w"> </span>build<span class="w"> </span>--dsp-core<span class="w"> </span>diffuser
<span class="c1"># simplified vectorscope (no SoC / menu system)</span>
pdm<span class="w"> </span>vectorscope_no_soc<span class="w"> </span>build
</pre></div>
</div>
<p>Generally, bitstreams are also built in CI - check <code class="docutils literal notranslate"><span class="pre">.github/workflows</span></code> if you need more gruesome details on how systems are built.</p>
<p>For SoC projects that have firmware, for quicker iteration, <code class="docutils literal notranslate"><span class="pre">--fw-only</span></code> is useful to only re-build the firmware for that bitstream and repackage the archive, without re-synthesizing the bitstream (which often takes quite a while).</p>
</section>
<section id="flashing">
<h2>Flashing<a class="headerlink" href="#flashing" title="Link to this heading"></a></h2>
<p>When you build projects from the command line, it will create a <em>Bitstream Archive</em>, which is a <code class="docutils literal notranslate"><span class="pre">.tar.gz</span></code> file that contains everything the bootloader needs to start a custom bitstream. Details on the inner workings of these archives can be found in the <a class="reference internal" href="../bootloader.html"><span class="doc">Bootloader</span></a> section.</p>
<p>You can flash custom bitstreams to one of 8 slots, using the built-in <code class="docutils literal notranslate"><span class="pre">pdm</span> <span class="pre">flash</span></code> command. To flash a bitstream archive you have just built, you can use <code class="docutils literal notranslate"><span class="pre">pdm</span> <span class="pre">flash</span> <span class="pre">archive</span></code> as follows:</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For prototype hardware, you may need to reflash the RP2040 and bootloader bitstream  per <a class="reference internal" href="../bootloader.html"><span class="doc">Bootloader</span></a>, before the following instructions will work.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Flash user bitstreams to the desired slot (0-7)</span>
pdm<span class="w"> </span>flash<span class="w"> </span>archive<span class="w"> </span>build/selftest-r4/selftest-*.tar.gz<span class="w"> </span>--slot<span class="w"> </span><span class="m">1</span>
pdm<span class="w"> </span>flash<span class="w"> </span>archive<span class="w"> </span>build/xbeam-r4/xbeam-*.tar.gz<span class="w"> </span>--slot<span class="w"> </span><span class="m">2</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pdm</span> <span class="pre">flash</span></code> also supplies a <code class="docutils literal notranslate"><span class="pre">status</span></code> command to read back the Tiliqua’s SPI flash to see what is currently on there:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pdm<span class="w"> </span>flash<span class="w"> </span>status
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you want to avoid audio pops while flashing, it is best to flash from the bootloader bitstream, as the audio CODEC is always muted in that bitstream.</p>
</div>
<p>If you are running an SoC, you can monitor serial output like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>picocom<span class="w"> </span>-b<span class="w"> </span><span class="m">115200</span><span class="w"> </span>/dev/ttyACM0
</pre></div>
</div>
<p>For non-SoC projects that don’t require extra firmware, note that you can also directly flash bitstreams to the SRAM of the FPGA like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>openFPGALoader<span class="w"> </span>-c<span class="w"> </span>dirtyJtag<span class="w"> </span>build/dsp-mirror-r4/top.bit
</pre></div>
</div>
<p>This flashes much quicker, as we don’t have to wait for flash pages to update. This can be useful for quickly iterating on DSP gateware. In the future, this will be possible with SoC bitstreams as well, but requires an extra bridge to directly stream debug firmware to the PSRAM from the host, which isn’t implemented yet.</p>
</section>
<section id="video-modes">
<h2>Video Modes<a class="headerlink" href="#video-modes" title="Link to this heading"></a></h2>
<p>From the Tiliqua bootloader (or whenever a display is hotplugged whilst in the bootloader), Tiliqua reads the attached display EDID to determine which display timings to use. Tiliqua will adapt to the first timing descriptor it finds, and if none of them can be met (usually if the pixel clock is too fast), it falls back to 1280x720p60. You can inspect the logs as to how the bootloader decided which display mode to use by looking at the serial telemetry on the debug port.</p>
<p>Depending on the project, Tiliqua user bitstreams may:</p>
<ul class="simple">
<li><p>Not use the video output at all (for example <code class="docutils literal notranslate"><span class="pre">pdm</span> <span class="pre">dsp</span></code> and <code class="docutils literal notranslate"><span class="pre">pdm</span> <span class="pre">usb_audio</span></code> are audio-only)</p></li>
<li><p>Use a static video mode (for example <code class="docutils literal notranslate"><span class="pre">pdm</span> <span class="pre">vectorscope_no_soc</span></code>)</p></li>
<li><p>Support dynamic video modes (all SoC bitstreams)</p></li>
</ul>
<p>Dynamic video modes are useful as the same bitstream can be used/shared, regardless of which screen is plugged in. When dynamic video modes are supported, the user bitstream will inherit the video mode that was autodetected by the bootloader (this is communicated by a <code class="docutils literal notranslate"><span class="pre">bootinfo</span></code> struct saved to PSRAM before the user bitstream is booted).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If for some reason you want to disable EDID reading and use a static/specific mode, you can always re-build and re-flash all bitstreams using a flag like <code class="docutils literal notranslate"><span class="pre">--modeline</span> <span class="pre">1280x720p60</span></code> to force a static modeline, disabling dynamic mode detection. Note that the bootloader built with a static modeline can <em>only</em> start bitstreams that are also built with a static modeline, however a bootloader built for dynamic modelines can start <em>both</em> types of bitstreams. The bootloader will display an error if these conditions are not met.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Getting Started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="simulation.html" class="btn btn-neutral float-right" title="Simulating designs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024—2025, S. Holzapfel and Tiliqua contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>